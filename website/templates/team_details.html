{% extends 'base.html' %}

{% block title %}Team Details - {{ team['team_name'] }}{% endblock %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/team_details.css') }}">
<h1>{{ team['team_name'] }} Details</h1>

<h2>Recent Matches</h2>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Match</th>
            <th>Home Team</th>
            <th>Away Team</th>
            <th>Score</th>
        </tr>
    </thead>
    <tbody>
        {% for match in matches %}
        <tr>
            <td><a href="{{ url_for('views.match_details', match_id=match['match_id']) }}">{{ match['match_name'] }}</a></td>
            <td><a 
                href="{{ url_for('views.team_details', team_id=match['home_team_id']) }}" 
                onclick="if(window.location.pathname === this.pathname) location.reload();">
                {{ match['home_team'] }}
            </a></td>
            <td><a 
                href="{{ url_for('views.team_details', team_id=match['away_team_id']) }}" 
                onclick="if(window.location.pathname === this.pathname) location.reload();">
                {{ match['away_team'] }}
            </a></td>
            <td>{{ match['score'] }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<nav aria-label="Page navigation">
    <ul class="pagination">
      {% if page > 1 %}
        <li class="page-item"><a class="page-link" href="{{ url_for('views.team_details', team_id=team['team_id'], page=page-1) }}">Previous</a></li>
      {% endif %}
      {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if page == p %}active{% endif %}">
          <a class="page-link" href="{{ url_for('views.team_details', team_id=team['team_id'], page=p) }}">{{ p }}</a>
        </li>
      {% endfor %}
      {% if page < total_pages %}
        <li class="page-item"><a class="page-link" href="{{ url_for('views.team_details', team_id=team['team_id'], page=page+1) }}">Next</a></li>
      {% endif %}
    </ul>
</nav>

<h2>Comments</h2>
{% if current_user.is_authenticated %}
<form method="POST" action="{{ url_for('views.team_details', team_id=team['team_id']) }}">
    <div class="form-group">
        <textarea name="comment" class="form-control" rows="3" placeholder="Add a comment..."></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Post Comment</button>
</form>
{% else %}
<p>You need to <a href="{{ url_for('auth.login') }}">log in</a> to post a comment.</p>
{% endif %}

{% if comments %}
<ul class="list-group mt-4">
    {% for comment in comments %}
    <li class="list-group-item">
        <strong>{{ comment['username'] }}</strong> <small class="text-muted">{{ comment['created_at'] }}</small>
        <p>{{ comment['comment'] }}</p>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No comments yet.</p>
{% endif %}

<a class="btn btn-dark mt-4" href="{{ url_for('views.home') }}">Back to Home</a>
{% endblock %}