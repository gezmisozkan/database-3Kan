{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/matches.css') }}">

<h1 class="mb-4">Football Matches</h1>

<form method="post" class="mb-4">
    <div class="row">
        <div class="col-md-6">
            <select name="team" class="form-select" required>
                <option value="" disabled {% if not selected_team %}selected{% endif %}>Select a team</option>
                {% for team in teams %}
                  <option value="{{ team }}" {% if team == selected_team %}selected{% endif %}>{{ team }}</option>
                {% endfor %}
             </select>             
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary">Show Matches</button>
        </div>
    </div>
</form>

{% if matches %}
    <h2>Matches for {{ selected_team }}</h2>
    <table class="table table-striped">
        <thead>
          <tr>
            <th>Match</th>
            <th>Home Team</th>
            <th>Away Team</th>
            <th>Home Goals</th>
            <th>Away Goals</th>
            {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <th>Actions</th>
            {% endif %}
        </tr>
        </thead>
        <tbody>
            {% for match in matches %}
            <tr>
                <td><a href="{{ url_for('views.match_details', match_id=match['match_id']) }}">{{ match['match_id'] }}</a></td>
                <td><a href="{{ url_for('views.team_details', team_id=match['home_team_id']) }}">{{ match['home_team_name'] }}</a></td>
                <td><a href="{{ url_for('views.team_details', team_id=match['away_team_id']) }}">{{ match['away_team_name'] }}</a></td>
                <td>{{ match['home_team_score'] }}</td>  
                <td>{{ match['away_team_score'] }}</td> 
                
                {% if current_user.is_authenticated and current_user.role == 'admin' %}
                <td>
                  <form method="POST" action="{{ url_for('views.delete_match', match_id=match['match_id']) }}" style="display:inline;">
                      <input type="hidden" name="page" value="{{ page }}">
                      <input type="hidden" name="selected_team" value="{{ selected_team }}">
                      <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this match?');">Delete</button>
                  </form>
              </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <nav aria-label="Page navigation">
        <ul class="pagination">
          <!-- Previous button -->
          {% if page > 1 %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('views.matches', page=page-1, selected_team=selected_team) }}">Previous</a>
            </li>
          {% endif %}
      
          <!-- Always show first page -->
          {% if page > 3 %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('views.matches', page=1, selected_team=selected_team) }}">1</a>
            </li>
            {% if page > 4 %}
              <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
          {% endif %}
      
          <!-- Dynamic range of pages near the current page -->
          {% for p in range(page - 2, page + 3) %}
            {% if p > 0 and p <= total_pages %}
              <li class="page-item {% if page == p %}active{% endif %}">
                <a class="page-link" href="{{ url_for('views.matches', page=p, selected_team=selected_team) }}">{{ p }}</a>
              </li>
            {% endif %}
          {% endfor %}
      
          <!-- Always show last page -->
          {% if page < total_pages - 2 %}
            {% if page < total_pages - 3 %}
              <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('views.matches', page=total_pages, selected_team=selected_team) }}">{{ total_pages }}</a>
            </li>
          {% endif %}
      
          <!-- Next button -->
          {% if page < total_pages %}
            <li class="page-item">
              <a class="page-link" href="{{ url_for('views.matches', page=page+1, selected_team=selected_team) }}">Next</a>
            </li>
          {% endif %}
        </ul>
      </nav>          
      
{% elif selected_team %}
    <p>No matches found for {{ selected_team }}.</p>
{% endif %}
{% endblock %}

