{%extends "base.html"%} {% block title %}Seasons{% endblock %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/seasons.css') }}">
<h1 class="mb-4">Seasons Table</h1>
<form action="/seasons" method="GET" class="mb-4">
    <div class="row g-3">
        <div class="col">
            <input type="text" name="season" class="form-control" placeholder="Season (e.g., 2002)">
        </div>
        <div class="col">
            <input type="text" name="tier" class="form-control" placeholder="Tier (e.g., 3)">
        </div>
        <div class="col">
            <input type="text" name="division" class="form-control" placeholder="Division (e.g., First Division)">
        </div>
        <div class="col">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </div>
</form>

{% if seasons %}
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Key ID</th>
            <th>Season ID</th>
            <th>Season</th>
            <th>Tier</th>
            <th>Division</th>
            <th>Subdivision</th>
            <th>Winner</th>
            <th>Team Count</th>
            {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <th>Actions</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for season in seasons %}
        <tr>
            <td>{{ season['key_id'] }}</td>
            <td><a href="{{ url_for('views.season_overview', season_id=season['season_id']) }}">{{ season['season_id'] }}</a></td>
            <td><a href="{{ url_for('views.season_tiers', year=season['season']) }}">{{ season['season'] }}</a></td>
            <td>{{ season['season'] }}</td>
            <td>{{ season['tier'] }}</td>
            <td>{{ season['division'] }}</td>
            <td>{{ season['subdivision'] }}</td>
            <td>{{ season['winner'] }}</td>
            <td>{{ season['count_teams'] }}</td>
            {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <td>
                <form method="POST" action="{{ url_for('views.delete_season', season_id=season['season_id']) }}" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this season?');">Delete</button>
                </form>
            </td>
            {% endif %}
        </tr>
        {% endfor %}     
    </tbody>
</table>

<nav aria-label="Page navigation">
    <ul class="pagination">
      {% if page > 1 %}
        <li class="page-item"><a class="page-link" href="{{ url_for('views.search_seasons', page=page-1, season=season, tier=tier, division=division) }}">Previous</a></li>
      {% endif %}
      {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if page == p %}active{% endif %}">
          <a class="page-link" href="{{ url_for('views.search_seasons', page=p, season=season, tier=tier, division=division) }}">{{ p }}</a>
        </li>
      {% endfor %}
      {% if page < total_pages %}
        <li class="page-item"><a class="page-link" href="{{ url_for('views.search_seasons', page=page+1, season=season, tier=tier, division=division) }}">Next</a></li>
      {% endif %}
    </ul>
</nav>  

{% else %}
<p>No results found.</p>
{% endif %}
{% endblock content %}